rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to the shared sensory maps.
     *              These maps are publicly readable. Creating new maps is allowed for
     *              any user. Updates are only allowed if the request contains the
     *              correct `editCode` for the document.
     * @path /sensoryMaps/{mapId}
     * @allow (get, list) Anyone can read the maps.
     * @allow (create) Anyone can create a new map.
     * @allow (update) The user can update if they provide the correct edit code.
     * @deny (delete) No one can delete maps from the client.
     */
    match /sensoryMaps/{mapId} {
      allow get, list: if true;
      allow create: if true;
      // The editCode is a secret field. Only someone who knows the code can update the map.
      // The server action (`updateMap`) enforces this check.
      allow update: if request.resource.data.editCode == resource.data.editCode;
      allow delete: if false;
    }

    // Default deny all other collections
    match /{path=**} {
      allow read, write: if false;
    }
  }
}
